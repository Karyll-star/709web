<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>电控学院电量使用统计</title>
  <script type="text/javascript" src="https://unpkg.com/@antv/g2plot@latest/dist/g2plot.min.js"></script>
  <script type="module" src="./ecust-electricity-statistics/data.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f7fa;
      color: #333;
    }
    .header {
      text-align: center;
      margin-bottom: 30px;
    }
    h1 {
      color: #2c3e50;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #7f8c8d;
      font-size: 16px;
    }
    .dashboard {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      max-width: 1400px;
      margin: 0 auto;
    }
    .chart-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      padding: 20px;
      flex: 1;
      min-width: 600px;
    }
    .chart-title {
      font-size: 18px;
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .stats-summary {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    .stat-card {
      background: #f8f9fa;
      border-radius: 6px;
      padding: 15px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.03);
    }
    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: #3498db;
      margin: 5px 0;
    }
    .stat-label {
      font-size: 14px;
      color: #7f8c8d;
    }
    .legend {
      margin-top: 15px;
      font-size: 14px;
      color: #7f8c8d;
    }
    .tooltip {
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 14px;
      max-width: 300px;
    }
  </style>
</head>
<body>
  <div class="header">
    <a href="index.html" style="position: absolute; top: 20px; left: 20px; text-decoration: none; padding: 10px 15px; background-color: #3498db; color: white; border-radius: 5px; font-weight: bold;">返回首页</a>
    <h1>电控学院用电数据分析</h1>
    <p class="subtitle">实时监测 | 数据可视化 | 用电统计</p>
  </div>
  
  <div class="dashboard">
    <div class="chart-container">
      <div class="stats-summary">
        <div class="stat-card">
          <div class="stat-value" id="daily-avg">0 kWh</div>
          <div class="stat-label">日均用电</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="daily-max">0 kWh</div>
          <div class="stat-label">单日最高</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="daily-min">0 kWh</div>
          <div class="stat-label">单日最低</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="daily-total">0 kWh</div>
          <div class="stat-label">本周总量</div>
        </div>
      </div>
    </div>
    <div class="chart-container">
      <div class="chart-title">
        <span>每小时用电量监测</span>
        <div class="legend">蓝线：实际用量 | 灰线：预测用量</div>
      </div>
      <div id="line-chart" style="height: 400px;"></div>
    </div>
    
    
  </div>

  <script type="module">
    // 计算每日用电统计
    function calculateDailyStats(data) {
      const dailyStats = {};
      
      data.forEach(item => {
        const date = item.time.split(' ')[0]; // 获取日期部分
        if (!dailyStats[date]) {
          dailyStats[date] = {
            date,
            total: 0,
            count: 0
          };
        }
        dailyStats[date].total += item.kWh;
        dailyStats[date].count++;
      });
      
      return Object.values(dailyStats);
    }
    
    // 计算统计摘要
    function calculateSummary(dailyData) {
      if (dailyData.length === 0) return {};
      
      let total = 0;
      let max = { date: '', value: Number.MIN_SAFE_INTEGER };
      let min = { date: '', value: Number.MAX_SAFE_INTEGER };
      
      dailyData.forEach(day => {
        const dayTotal = day.total;
        total += dayTotal;
        
        if (dayTotal > max.value) {
          max = { date: day.date, value: dayTotal };
        }
        
        if (dayTotal < min.value) {
          min = { date: day.date, value: dayTotal };
        }
      });
      
      return {
        total,
        max,
        min,
        avg: total / dailyData.length
      };
    }
    
    // 处理数据
    const dailyData = calculateDailyStats(data);
    const summary = calculateSummary(dailyData);
    
    // 渲染统计指标
    document.getElementById('daily-avg').textContent = `${summary.avg.toFixed(1)} kWh`;
    document.getElementById('daily-max').textContent = `${summary.max.value.toFixed(1)} kWh`;
    document.getElementById('daily-min').textContent = `${summary.min.value.toFixed(1)} kWh`;
    document.getElementById('daily-total').textContent = `${summary.total.toFixed(1)} kWh`;
    
    // 创建折线图
    const linePlot = new G2Plot.Line('line-chart', {
      data,
      xField: 'time',
      yField: 'kWh',
      seriesField: 'type',
      appendPadding: 20,
      smooth: true,
      color: ['#1890ff', '#a0d911'],
      lineStyle: {
        lineWidth: 3,
        strokeOpacity: 0.8,
      },
      meta: {
        time: {
          alias: '时间',
          formatter: val => {
            const date = new Date(val);
            return `${date.getMonth() + 1}/${date.getDate()} ${date.getHours()}:00`;
          }
        },
        kWh: {
          alias: '用电量 (kWh)',
          nice: true
        }
      },
      yAxis: {
        title: {
          text: '用电量 (kWh)',
          style: {
            fontSize: 14,
          }
        }
      },
      xAxis: {
        label: {
          autoRotate: true,
          autoHide: true,
        }
      },
      tooltip: {
        customContent: (title, items) => {
          const content = `<div class="tooltip">
            <div style="margin-bottom:5px;font-weight:bold">${title}</div>
            ${items.map(item => `
              <div style="display:flex;align-items:center">
                <div style="width:8px;height:8px;background:${item.color};margin-right:8px"></div>
                ${item.name}: ${parseFloat(item.value).toFixed(2)} kWh
              </div>
            `).join('')}
          </div>`;
          return content;
        }
      },
      slider: {
        start: 0.1,
        end: 0.9,
        trendCfg: {
          isArea: false,
        }
      },
      interactions: [
        { type: 'element-active', cfg: { showEnable: [{ trigger: 'element:mouseenter', action: 'cursor:pointer' }] } }
      ],
    });

    
    // 渲染图表
    linePlot.render();
  </script>
</body>
</html>